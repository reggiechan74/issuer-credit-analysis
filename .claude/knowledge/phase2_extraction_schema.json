{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Phase 2 Extraction Schema",
  "description": "Standardized JSON schema for Phase 2 financial data extraction. This schema MUST be followed by all extraction processes to ensure Phase 3 calculations work correctly.",
  "type": "object",
  "required": [
    "issuer_name",
    "reporting_date",
    "currency",
    "balance_sheet",
    "income_statement",
    "ffo_affo"
  ],
  "properties": {
    "issuer_name": {
      "type": "string",
      "description": "Full legal name of the issuer"
    },
    "reporting_date": {
      "type": "string",
      "format": "date",
      "description": "Reporting date in YYYY-MM-DD format"
    },
    "reporting_period": {
      "type": "string",
      "description": "Human-readable reporting period (e.g., 'Q2 2025')"
    },
    "currency": {
      "type": "string",
      "description": "Currency code (e.g., 'CAD', 'USD')"
    },
    "data_quality": {
      "type": "object",
      "description": "Optional metadata about data quality",
      "properties": {
        "completeness": {
          "type": "string",
          "enum": ["strong", "moderate", "limited"]
        },
        "source": {
          "type": "string"
        },
        "validation_notes": {
          "type": "string"
        }
      }
    },
    "balance_sheet": {
      "type": "object",
      "description": "Balance sheet data (FLAT structure - no nested objects)",
      "required": [
        "total_assets",
        "mortgages_noncurrent",
        "mortgages_current",
        "credit_facilities",
        "cash"
      ],
      "properties": {
        "reporting_date": {
          "type": "string",
          "format": "date"
        },
        "total_assets": {
          "type": "number",
          "description": "Total assets (thousands)"
        },
        "investment_properties": {
          "type": "number"
        },
        "investment_properties_held_for_sale": {
          "type": "number"
        },
        "equity_accounted_investments": {
          "type": "number"
        },
        "cash": {
          "type": "number",
          "description": "REQUIRED: Cash and cash equivalents"
        },
        "total_liabilities": {
          "type": "number"
        },
        "mortgages_noncurrent": {
          "type": "number",
          "description": "REQUIRED: Non-current mortgages and loans payable"
        },
        "mortgages_current": {
          "type": "number",
          "description": "REQUIRED: Current portion of mortgages and loans"
        },
        "credit_facilities": {
          "type": "number",
          "description": "REQUIRED: Credit facility borrowings"
        },
        "senior_unsecured_debentures": {
          "type": "number",
          "description": "Senior unsecured debentures (optional, defaults to 0)"
        },
        "total_unitholders_equity": {
          "type": "number"
        },
        "common_units_outstanding": {
          "type": "number",
          "description": "Number of common units/shares outstanding (basic)"
        },
        "diluted_units_outstanding": {
          "type": "number",
          "description": "Number of diluted units/shares outstanding (includes convertible securities, options, warrants)"
        }
      }
    },
    "dilution_detail": {
      "type": "object",
      "description": "Optional detailed breakdown of share dilution (extract when issuer discloses calculation in MD&A)",
      "properties": {
        "basic_units": {
          "type": "number",
          "description": "Basic weighted average units (starting point for dilution calc)"
        },
        "dilutive_instruments": {
          "type": "object",
          "description": "Breakdown of dilutive securities by type",
          "properties": {
            "restricted_units": {
              "type": "number",
              "description": "Dilutive effect of restricted share/unit awards (RSUs/PSUs)"
            },
            "deferred_units": {
              "type": "number",
              "description": "Dilutive effect of deferred share/unit awards (DSUs/DUs)"
            },
            "stock_options": {
              "type": "number",
              "description": "Dilutive effect of employee/director stock options"
            },
            "convertible_debentures": {
              "type": "number",
              "description": "Dilutive effect of convertible debt (if-converted basis)"
            },
            "warrants": {
              "type": "number",
              "description": "Dilutive effect of outstanding warrants"
            },
            "other": {
              "type": "number",
              "description": "Other dilutive securities not categorized above"
            }
          }
        },
        "diluted_units_calculated": {
          "type": "number",
          "description": "Sum of basic + all dilutive instruments (for reconciliation)"
        },
        "diluted_units_reported": {
          "type": "number",
          "description": "Diluted units as reported by issuer (may differ if anti-dilutive instruments excluded)"
        },
        "dilution_percentage": {
          "type": "number",
          "description": "Percentage dilution: (diluted - basic) / basic * 100"
        },
        "reconciliation_note": {
          "type": "string",
          "description": "Explanation of any variance between calculated and reported diluted units"
        },
        "disclosure_source": {
          "type": "string",
          "description": "Source reference (e.g., 'Q2 2025 MD&A page 21')"
        }
      }
    },
    "income_statement": {
      "type": "object",
      "description": "Income statement data - MUST include top-level noi and interest_expense",
      "required": [
        "noi",
        "interest_expense",
        "revenue"
      ],
      "properties": {
        "noi": {
          "type": "number",
          "description": "REQUIRED: Net Operating Income for the most recent period (e.g., Q2)"
        },
        "interest_expense": {
          "type": "number",
          "description": "REQUIRED: Interest expense for the most recent period (absolute value, positive number)"
        },
        "revenue": {
          "type": "number",
          "description": "REQUIRED: Total revenue for the most recent period"
        },
        "q2_2025": {
          "type": "object",
          "description": "Optional: Detailed Q2 2025 income statement"
        },
        "ytd_2025": {
          "type": "object",
          "description": "Optional: YTD 2025 income statement"
        },
        "q2_2024": {
          "type": "object",
          "description": "Optional: Q2 2024 comparative income statement"
        },
        "ytd_2024": {
          "type": "object",
          "description": "Optional: YTD 2024 comparative income statement"
        }
      }
    },
    "ffo_affo": {
      "type": "object",
      "description": "FFO/AFFO metrics - MUST include top-level values for most recent period",
      "required": [
        "ffo",
        "affo",
        "ffo_per_unit",
        "affo_per_unit",
        "distributions_per_unit"
      ],
      "properties": {
        "ffo": {
          "type": "number",
          "description": "REQUIRED: Funds From Operations (most recent period, e.g., Q2)"
        },
        "affo": {
          "type": "number",
          "description": "REQUIRED: Adjusted Funds From Operations (most recent period)"
        },
        "ffo_per_unit": {
          "type": "number",
          "description": "REQUIRED: FFO per unit - basic (most recent period)"
        },
        "ffo_per_unit_diluted": {
          "type": "number",
          "description": "FFO per unit - diluted (most recent period, if disclosed)"
        },
        "affo_per_unit": {
          "type": "number",
          "description": "REQUIRED: AFFO per unit - basic (most recent period)"
        },
        "affo_per_unit_diluted": {
          "type": "number",
          "description": "AFFO per unit - diluted (most recent period, if disclosed)"
        },
        "distributions_per_unit": {
          "type": "number",
          "description": "REQUIRED: Distributions per unit (most recent period)"
        },
        "q2_2025": {
          "type": "object",
          "description": "Optional: Detailed Q2 2025 FFO/AFFO metrics"
        },
        "ytd_2025": {
          "type": "object",
          "description": "Optional: YTD 2025 FFO/AFFO metrics"
        }
      }
    },
    "portfolio": {
      "type": "object",
      "description": "Optional portfolio metrics",
      "properties": {
        "total_properties": {
          "type": "number"
        },
        "total_gla_sf": {
          "type": ["number", "null"],
          "description": "Total gross leasable area in square feet"
        },
        "occupancy_rate": {
          "type": "number",
          "description": "Physical occupancy rate (decimal, e.g., 0.878 for 87.8%)"
        },
        "occupancy_with_commitments": {
          "type": "number",
          "description": "Occupancy including signed commitments (decimal)"
        },
        "same_property_noi_growth_6m": {
          "type": "number",
          "description": "6-month same property NOI growth (decimal, e.g., 0.023 for 2.3%)"
        }
      }
    },
    "ffo_affo_components": {
      "type": "object",
      "description": "Optional FFO/AFFO calculation components per REALPAC methodology. Include when issuer doesn't report FFO/AFFO or to enable validation.",
      "properties": {
        "net_income_ifrs": {
          "type": "number",
          "description": "IFRS net income (starting point for FFO calculation)"
        },
        "unrealized_fv_changes": {
          "type": "number",
          "description": "Adjustment A: Unrealized fair value changes in investment properties"
        },
        "depreciation_real_estate": {
          "type": "number",
          "description": "Adjustment B: Depreciation of depreciable real estate assets"
        },
        "amortization_tenant_allowances": {
          "type": "number",
          "description": "Adjustment C: Amortization of tenant allowances for fit-out"
        },
        "amortization_intangibles": {
          "type": "number",
          "description": "Adjustment D: Amortization of tenant/customer relationship intangibles"
        },
        "gains_losses_property_sales": {
          "type": "number",
          "description": "Adjustment E: Gains/losses from sales of investment properties"
        },
        "tax_on_disposals": {
          "type": "number",
          "description": "Adjustment F: Tax on gains or losses on disposals of properties"
        },
        "deferred_taxes": {
          "type": "number",
          "description": "Adjustment G: Deferred taxes"
        },
        "impairment_losses_reversals": {
          "type": "number",
          "description": "Adjustment H: Impairment losses or reversals on real estate"
        },
        "revaluation_gains_losses": {
          "type": "number",
          "description": "Adjustment I: Revaluation gains/losses on owner-occupied properties"
        },
        "transaction_costs_business_comb": {
          "type": "number",
          "description": "Adjustment J: Transaction costs from business combinations"
        },
        "foreign_exchange_gains_losses": {
          "type": "number",
          "description": "Adjustment K: Foreign exchange gains/losses (non-net investment)"
        },
        "sale_foreign_operations": {
          "type": "number",
          "description": "Adjustment L: Gain/loss on sale of foreign operations"
        },
        "fv_changes_hedges": {
          "type": "number",
          "description": "Adjustment M: Fair value changes of economically effective hedges"
        },
        "goodwill_impairment": {
          "type": "number",
          "description": "Adjustment N: Goodwill impairment or negative goodwill"
        },
        "puttable_instruments_effects": {
          "type": "number",
          "description": "Adjustment O: Effects of puttable instruments classified as liabilities"
        },
        "discontinued_operations": {
          "type": "number",
          "description": "Adjustment P: Results of discontinued operations"
        },
        "equity_accounted_adjustments": {
          "type": "number",
          "description": "Adjustment Q: Adjustments for equity accounted entities"
        },
        "incremental_leasing_costs": {
          "type": "number",
          "description": "Adjustment R: Incremental leasing costs"
        },
        "property_taxes_ifric21": {
          "type": "number",
          "description": "Adjustment S: Property taxes accounted for under IFRIC 21"
        },
        "rou_asset_revenue_expense": {
          "type": "number",
          "description": "Adjustment T: Operational revenue/expenses from Right of Use Assets"
        },
        "non_controlling_interests_ffo": {
          "type": "number",
          "description": "Adjustment U: Non-controlling interests in respect of FFO adjustments. Per REALPAC Jan 2022: Include NCI adjustment to deduct NCI for consolidated investments in entities that have puttable units classified as financial liabilities under IAS 32, where NCI has not been deducted as a result of being treated as a liability rather than equity."
        },
        "capex_sustaining": {
          "type": "number",
          "description": "Adjustment V: Sustaining/maintenance capital expenditures (for AFFO)"
        },
        "capex_development": {
          "type": "number",
          "description": "Development CAPEX (for disclosure, excluded from AFFO)"
        },
        "leasing_costs": {
          "type": "number",
          "description": "Adjustment W: Leasing costs (internal + external, non-development)"
        },
        "tenant_improvements": {
          "type": "number",
          "description": "Adjustment X: Tenant improvements (sustaining only)"
        },
        "straight_line_rent": {
          "type": "number",
          "description": "Adjustment Y: Straight-line rent adjustment"
        },
        "non_controlling_interests_affo": {
          "type": "number",
          "description": "Adjustment Z: Non-controlling interests in respect of AFFO adjustments. Per REALPAC Jan 2022: Include NCI adjustment to deduct NCI for consolidated investments in entities that have puttable units classified as financial liabilities under IAS 32, where NCI has not been deducted as a result of being treated as a liability rather than equity."
        },
        "calculation_method": {
          "type": "string",
          "enum": ["actual", "reserve", "hybrid"],
          "description": "Method used: actual amounts, reserve estimates, or hybrid"
        },
        "reserve_methodology": {
          "type": "string",
          "description": "If reserve used, describe calculation (e.g., '3-year rolling average')"
        },
        "missing_adjustments": {
          "type": "array",
          "items": {"type": "string"},
          "description": "List of adjustments that couldn't be extracted"
        }
      }
    },
    "acfo_components": {
      "type": "object",
      "description": "Optional ACFO calculation components per REALPAC ACFO White Paper (January 2023). Include when issuer doesn't report ACFO or to enable validation.",
      "properties": {
        "cash_flow_from_operations": {
          "type": "number",
          "description": "IFRS Cash Flow from Operations (starting point for ACFO calculation)"
        },
        "change_in_working_capital": {
          "type": "number",
          "description": "Adjustment 1: Change in working capital to eliminate non-sustainable fluctuations"
        },
        "interest_financing": {
          "type": "number",
          "description": "Adjustment 2: Interest expense included in cash flow from financing activities"
        },
        "jv_distributions": {
          "type": "number",
          "description": "Adjustment 3: Distributions received from joint ventures"
        },
        "jv_acfo": {
          "type": "number",
          "description": "Adjustment 3 (alternative): ACFO from joint ventures (calculated per REALPAC)"
        },
        "jv_notional_interest": {
          "type": "number",
          "description": "Adjustment 3: Notional interest that would have been capitalized on JV development"
        },
        "capex_sustaining_acfo": {
          "type": "number",
          "description": "Adjustment 4: Sustaining/maintenance capital expenditures (must match AFFO capex_sustaining)"
        },
        "capex_development_acfo": {
          "type": "number",
          "description": "Adjustment 4: Development capital expenditures (disclosure only, excluded from ACFO)"
        },
        "leasing_costs_external": {
          "type": "number",
          "description": "Adjustment 5: External leasing costs only (internal already expensed in CFO)"
        },
        "tenant_improvements_acfo": {
          "type": "number",
          "description": "Adjustment 6: Sustaining tenant improvements (must match AFFO tenant_improvements)"
        },
        "realized_investment_gains_losses": {
          "type": "number",
          "description": "Adjustment 7: Realized gains/losses on marketable securities not in CFO"
        },
        "taxes_non_operating": {
          "type": "number",
          "description": "Adjustment 8: Taxes related to non-operating activities (e.g., disposal taxes)"
        },
        "transaction_costs_acquisitions": {
          "type": "number",
          "description": "Adjustment 9: Transaction costs for acquiring investment properties"
        },
        "transaction_costs_disposals": {
          "type": "number",
          "description": "Adjustment 10: Transaction costs for disposing of investment properties"
        },
        "deferred_financing_fees": {
          "type": "number",
          "description": "Adjustment 11: Deferred financing fees (amortization)"
        },
        "debt_termination_costs": {
          "type": "number",
          "description": "Adjustment 12: Costs to terminate debt"
        },
        "off_market_debt_favorable": {
          "type": "number",
          "description": "Adjustment 13: Favorable off-market debt adjustments"
        },
        "off_market_debt_unfavorable": {
          "type": "number",
          "description": "Adjustment 13: Unfavorable off-market debt adjustments"
        },
        "interest_income_timing": {
          "type": "number",
          "description": "Adjustment 14: Interest income timing adjustments"
        },
        "interest_expense_timing": {
          "type": "number",
          "description": "Adjustment 14: Interest expense timing adjustments"
        },
        "puttable_instruments_distributions": {
          "type": "number",
          "description": "Adjustment 15: Distributions on puttable instruments treated as interest expense"
        },
        "rou_sublease_principal_received": {
          "type": "number",
          "description": "Adjustment 16: Principal portion of finance lease payments earned (ROU revenue)"
        },
        "rou_sublease_interest_received": {
          "type": "number",
          "description": "Adjustment 16: Interest income on finance lease subleases (ROU revenue)"
        },
        "rou_lease_principal_paid": {
          "type": "number",
          "description": "Adjustment 16: Principal payments on ground leases (ROU expense)"
        },
        "rou_depreciation_amortization": {
          "type": "number",
          "description": "Adjustment 16: Depreciation/amortization on ROU assets (add back if cost model)"
        },
        "non_controlling_interests_acfo": {
          "type": "number",
          "description": "Adjustment 17: NCI in respect of all above ACFO adjustments"
        },
        "nci_puttable_units": {
          "type": "number",
          "description": "Adjustment 17: NCI for consolidated entities with puttable units as liabilities (IAS 32)"
        },
        "calculation_method_acfo": {
          "type": "string",
          "enum": ["actual", "reserve", "hybrid"],
          "description": "Method used for CAPEX/leasing costs/TI: actual, reserve, or hybrid"
        },
        "reserve_methodology_acfo": {
          "type": "string",
          "description": "If reserve used, describe calculation methodology"
        },
        "jv_treatment_method": {
          "type": "string",
          "enum": ["distributions", "acfo"],
          "description": "Joint venture treatment: use distributions received or calculated ACFO"
        },
        "missing_adjustments_acfo": {
          "type": "array",
          "items": {"type": "string"},
          "description": "List of ACFO adjustments that couldn't be extracted"
        }
      }
    },
    "cash_flow_investing": {
      "type": "object",
      "description": "Optional cash flow from investing activities (required for AFCF calculation). Extract from IFRS Cash Flow Statement investing section.",
      "properties": {
        "development_capex": {
          "type": "number",
          "description": "Development/growth capital expenditures NOT included in sustaining capex (negative number). Should match capex_development_acfo if available."
        },
        "property_acquisitions": {
          "type": "number",
          "description": "Cash paid for property acquisitions (negative number)"
        },
        "property_dispositions": {
          "type": "number",
          "description": "Cash received from property sales/dispositions (positive number)"
        },
        "jv_capital_contributions": {
          "type": "number",
          "description": "Capital invested in joint ventures (negative number)"
        },
        "jv_return_of_capital": {
          "type": "number",
          "description": "Return of capital from JV dispositions or exits (positive number)"
        },
        "business_combinations": {
          "type": "number",
          "description": "Cash paid for acquiring entire entities/portfolios (negative number)"
        },
        "other_investing_outflows": {
          "type": "number",
          "description": "Other investing cash outflows not categorized above (negative number)"
        },
        "other_investing_inflows": {
          "type": "number",
          "description": "Other investing cash inflows not categorized above (positive number)"
        },
        "total_cfi": {
          "type": "number",
          "description": "Total net cash from investing activities per IFRS cash flow statement (for reconciliation)"
        }
      }
    },
    "cash_flow_financing": {
      "type": "object",
      "description": "Optional cash flow from financing activities (required for AFCF coverage analysis). Extract from IFRS Cash Flow Statement financing section.",
      "properties": {
        "debt_principal_repayments": {
          "type": "number",
          "description": "Principal repayments on all debt (mortgages, credit facilities, debentures) (negative number)"
        },
        "new_debt_issuances": {
          "type": "number",
          "description": "Proceeds from new debt issuances (positive number)"
        },
        "distributions_common": {
          "type": "number",
          "description": "Distributions/dividends to common unitholders/shareholders (negative number)"
        },
        "distributions_preferred": {
          "type": "number",
          "description": "Distributions to preferred unitholders (negative number)"
        },
        "distributions_nci": {
          "type": "number",
          "description": "Distributions to non-controlling interests (negative number)"
        },
        "equity_issuances": {
          "type": "number",
          "description": "Proceeds from equity/unit issuances (positive number)"
        },
        "unit_buybacks": {
          "type": "number",
          "description": "Cash paid for unit/share buybacks (negative number)"
        },
        "deferred_financing_costs_paid": {
          "type": "number",
          "description": "Cash paid for deferred financing fees (negative number)"
        },
        "other_financing_outflows": {
          "type": "number",
          "description": "Other financing cash outflows not categorized above (negative number)"
        },
        "other_financing_inflows": {
          "type": "number",
          "description": "Other financing cash inflows not categorized above (positive number)"
        },
        "total_cff": {
          "type": "number",
          "description": "Total net cash from financing activities per IFRS cash flow statement (for reconciliation)"
        }
      }
    },
    "liquidity": {
      "type": "object",
      "description": "Optional liquidity position data (required for burn rate and cash runway analysis). Extract from balance sheet and note disclosures.",
      "properties": {
        "cash_and_equivalents": {
          "type": "number",
          "description": "Cash and cash equivalents (should match balance_sheet.cash)"
        },
        "marketable_securities": {
          "type": "number",
          "description": "Short-term marketable securities or investments (positive number, 0 if not disclosed separately)"
        },
        "restricted_cash": {
          "type": "number",
          "description": "Restricted cash that cannot be used for operations (positive number, 0 if none)"
        },
        "undrawn_credit_facilities": {
          "type": "number",
          "description": "Available undrawn capacity on credit facilities (positive number). Calculate as: facility_limit - facility_drawn. Use 0 if unavailable."
        },
        "credit_facility_limit": {
          "type": "number",
          "description": "Total credit facility limit/commitment (positive number)"
        },
        "available_cash": {
          "type": "number",
          "description": "Calculated: cash_and_equivalents + marketable_securities - restricted_cash"
        },
        "total_available_liquidity": {
          "type": "number",
          "description": "Calculated: available_cash + undrawn_credit_facilities"
        },
        "data_source": {
          "type": "string",
          "description": "Source of liquidity data (e.g., 'balance sheet', 'note 15 - credit facilities', 'estimated')"
        }
      }
    },
    "validation": {
      "type": "object",
      "description": "Optional validation checks",
      "properties": {
        "balance_sheet_balanced": {
          "type": "boolean"
        },
        "noi_margin_reasonable": {
          "type": "boolean"
        }
      }
    }
  }
}
